<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Gesture Logo Creator</title>
    <!-- Using Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Playfair+Display:wght@700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <!-- --- NEW: Including the Socket.IO client library --- -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            overflow: hidden;
            background: #f0f0f0;
        }
        .main-container { display: flex; height: 100vh; width: 100vw; }
        .mode-bar {
            width: 80px; background-color: #333; color: white;
            display: flex; flex-direction: column; align-items: center;
            padding-top: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.2); z-index: 10;
        }
        .mode-item {
            width: 60px; height: 60px; border: 2px solid #555; border-radius: 10px;
            margin-bottom: 15px; display: flex; justify-content: center;
            align-items: center; flex-direction: column; font-size: 12px;
            font-weight: bold; cursor: default; transition: all 0.3s ease; text-align: center;
        }
        .mode-item.active { background-color: #667eea; border-color: #899cff; transform: scale(1.1); }
        .mode-item .icon { font-size: 24px; margin-bottom: 4px; }
        .status-light {
            width: 20px; height: 20px; border-radius: 50%; background-color: #f8d7da;
            position: absolute; bottom: 20px; left: 30px; border: 2px solid #333;
            transition: background-color 0.5s ease;
        }
        .status-light.connected { background-color: #d4edda; }
        .text-display-area {
            flex-grow: 1; position: relative; background: #ffffff;
            overflow-y: auto; padding: 40px; display: flex;
            justify-content: center; align-items: center;
        }
        #text-display {
            font-size: 6em; font-family: 'Lobster', cursive; line-height: 1.2;
            white-space: pre-wrap; word-break: break-all; color: #333;
            transition: font-family 0.4s ease, font-size 0.2s linear;
        }
        #selection-indicator {
            position: absolute; top: 20px; right: 40px; font-size: 4em;
            font-family: 'Roboto Mono', monospace; color: rgba(0, 0, 0, 0.15); font-weight: bold; z-index: 5;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="mode-bar">
            <div id="mode-letters" class="mode-item active"><div class="icon">Aa</div><div>Letters</div></div>
            <div id="mode-fonts" class="mode-item"><div class="icon">F</div><div>Fonts</div></div>
            <div id="mode-size" class="mode-item"><div class="icon">‚Üï</div><div>Size</div></div>
            <div id="mode-print" class="mode-item"><div class="icon">‚úçÔ∏è</div><div>Print</div></div>
            <div id="mode-space" class="mode-item"><div class="icon">üëç</div><div>Space</div></div>
            <div id="mode-delete" class="mode-item"><div class="icon">‚å´</div><div>Delete</div></div>
            <div id="status-light" class="status-light"></div>
        </div>
        <div id="text-display-area" class="text-display-area">
            <p id="text-display"></p>
            <div id="selection-indicator"></div>
        </div>
    </div>

    <script>
        let CURRENT_MODE = 'letters'; 
        
        const modeItems = {
            letters: document.getElementById('mode-letters'),
            fonts: document.getElementById('mode-fonts'),
            size: document.getElementById('mode-size'),
            print: document.getElementById('mode-print'),
            space: document.getElementById('mode-space'),
            delete: document.getElementById('mode-delete')
        };
        const statusLight = document.getElementById('status-light');
        const textDisplay = document.getElementById('text-display');
        const selectionIndicator = document.getElementById('selection-indicator');

        // --- NEW: Connecting with Socket.IO ---
        const socket = io("http://localhost:5000");

        socket.on("connect", () => {
            console.log("Connected to Flask-SocketIO server!");
            statusLight.classList.add('connected');
        });

        socket.on("disconnect", () => {
            console.warn("Disconnected from server.");
            statusLight.classList.remove('connected');
        });

        // Listen for our custom event from the server
        socket.on("gesture_event", (jsonData) => {
            const data = JSON.parse(jsonData);
            console.log('Received:', data);

            switch (data.type) {
                case 'MODE_CHANGE':
                    CURRENT_MODE = data.mode;
                    setActiveMode(data.mode);
                    break;
                case 'PRINT':
                    addCharacter(data.char);
                    if (data.char === ' ') flashMode('space');
                    else flashMode('print');
                    break;
                case 'DELETE':
                    deleteLastCharacter();
                    flashMode('delete');
                    break;
                case 'FONT_CHANGE':
                    textDisplay.style.fontFamily = data.font;
                    break;
                case 'SIZE_CHANGE':
                    textDisplay.style.fontSize = data.size + 'em';
                    break;
                case 'SELECTION_UPDATE':
                    selectionIndicator.textContent = data.char;
                    break;
            }
        });

        function setActiveMode(activeMode) {
            Object.keys(modeItems).forEach(mode => {
                modeItems[mode].classList.toggle('active', mode === activeMode);
            });
        }
        
        function flashMode(modeToFlash) {
            if (modeItems[modeToFlash]) {
                const item = modeItems[modeToFlash];
                const isMainActive = item.classList.contains('active');
                item.classList.add('active');
                setTimeout(() => {
                     if (!isMainActive) item.classList.remove('active');
                }, 400);
            }
        }

        function addCharacter(char) {
            textDisplay.textContent += char;
        }

        function deleteLastCharacter() {
            textDisplay.textContent = textDisplay.textContent.slice(0, -1);
        }
    </script>
</body>
</html>
